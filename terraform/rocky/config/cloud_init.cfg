hostname: ${hostname}
fqdn: ${fqdn}
manage_etc_hosts: true
users:
  - name: eduardo
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users, wheel
    home: /home/eduardo
    shell: /bin/bash
    lock_passwd: false
    ssh_authorized_keys:
      - ${public_key}
ssh_pwauth: true
disable_root: false
chpasswd:
  list: |
    eduardo:123
  expire: False

# Configuración SSH específica para Rocky Linux
ssh:
  ssh_authorized_keys:
    - ${public_key}

# Paquetes específicos para Rocky Linux
packages:
    - qemu-guest-agent
    - python3
    - python3-pip
    - wget
    - curl
    - vim
    - git
    - epel-release
    - curl
    - vim
    - git
    - epel-release

# Configuración específica de Rocky Linux
bootcmd:
    - [ sh, -c, 'echo $(date) | sudo tee -a /root/bootcmd.log' ]

runcmd:
    # Configurar SSH primero
    - sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
    - sed -i 's/#PasswordAuthentication yes/PasswordAuthentication yes/g' /etc/ssh/sshd_config
    - sed -i 's/PubkeyAuthentication no/PubkeyAuthentication yes/g' /etc/ssh/sshd_config
    - sed -i 's/#PubkeyAuthentication yes/PubkeyAuthentication yes/g' /etc/ssh/sshd_config
    - systemctl restart sshd
    # Habilitar EPEL repository
    - dnf install -y epel-release
    - dnf update -y
    # Configurar locales español
    - dnf install -y glibc-langpack-es
    - localectl set-locale LANG=es_ES.UTF-8
    - localectl set-keymap es
    # Instalar herramientas adicionales que puedan ser necesarias
    - dnf groupinstall -y "Development Tools"
    # Habilitar y iniciar qemu-guest-agent
    - systemctl enable qemu-guest-agent
    - systemctl start qemu-guest-agent
    # Configurar firewall para OpenNebula (si es necesario)
    - systemctl enable firewalld
    - systemctl start firewalld
    - dnf groupinstall -y "Development Tools"
    # Habilitar y iniciar qemu-guest-agent
    - systemctl enable qemu-guest-agent
    - systemctl start qemu-guest-agent
    # Configurar firewall para OpenNebula (si es necesario)
    - systemctl enable firewalld
    - systemctl start firewalld

final_message: "Rocky Linux system is finally up, after $UPTIME seconds"